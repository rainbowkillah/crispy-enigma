> npm test


> test
> vitest run

(node:97898) Warning: The 'NO_COLOR' env is ignored due to the 'FORCE_COLOR' env being set.
(Use `node --trace-warnings ...` to show where the warning was created)

 RUN  v4.0.18 /home/dfox/projects-cf/crispy-enigma

(node:97997) Warning: The 'NO_COLOR' env is ignored due to the 'FORCE_COLOR' env being set.
(Use `node --trace-warnings ...` to show where the warning was created)
(node:97998) Warning: The 'NO_COLOR' env is ignored due to the 'FORCE_COLOR' env being set.
(Use `node --trace-warnings ...` to show where the warning was created)
(node:97978) Warning: The 'NO_COLOR' env is ignored due to the 'FORCE_COLOR' env being set.
(Use `node --trace-warnings ...` to show where the warning was created)
(node:98106) Warning: The 'NO_COLOR' env is ignored due to the 'FORCE_COLOR' env being set.
(Use `node --trace-warnings ...` to show where the warning was created)
(node:98026) Warning: The 'NO_COLOR' env is ignored due to the 'FORCE_COLOR' env being set.
(Use `node --trace-warnings ...` to show where the warning was created)
(node:97990) Warning: The 'NO_COLOR' env is ignored due to the 'FORCE_COLOR' env being set.
(Use `node --trace-warnings ...` to show where the warning was created)
(node:98099) Warning: The 'NO_COLOR' env is ignored due to the 'FORCE_COLOR' env being set.
(Use `node --trace-warnings ...` to show where the warning was created)
(node:98021) Warning: The 'NO_COLOR' env is ignored due to the 'FORCE_COLOR' env being set.
(Use `node --trace-warnings ...` to show where the warning was created)
(node:98189) Warning: The 'NO_COLOR' env is ignored due to the 'FORCE_COLOR' env being set.
(Use `node --trace-warnings ...` to show where the warning was created)
(node:98222) Warning: The 'NO_COLOR' env is ignored due to the 'FORCE_COLOR' env being set.
(Use `node --trace-warnings ...` to show where the warning was created)
(node:98004) Warning: The 'NO_COLOR' env is ignored due to the 'FORCE_COLOR' env being set.
(Use `node --trace-warnings ...` to show where the warning was created)
(node:98277) Warning: The 'NO_COLOR' env is ignored due to the 'FORCE_COLOR' env being set.
(Use `node --trace-warnings ...` to show where the warning was created)
(node:98111) Warning: The 'NO_COLOR' env is ignored due to the 'FORCE_COLOR' env being set.
(Use `node --trace-warnings ...` to show where the warning was created)
(node:98253) Warning: The 'NO_COLOR' env is ignored due to the 'FORCE_COLOR' env being set.
(Use `node --trace-warnings ...` to show where the warning was created)
(node:98154) Warning: The 'NO_COLOR' env is ignored due to the 'FORCE_COLOR' env being set.
(Use `node --trace-warnings ...` to show where the warning was created)
(node:98139) Warning: The 'NO_COLOR' env is ignored due to the 'FORCE_COLOR' env being set.
(Use `node --trace-warnings ...` to show where the warning was created)
(node:98163) Warning: The 'NO_COLOR' env is ignored due to the 'FORCE_COLOR' env being set.
(Use `node --trace-warnings ...` to show where the warning was created)
(node:98240) Warning: The 'NO_COLOR' env is ignored due to the 'FORCE_COLOR' env being set.
(Use `node --trace-warnings ...` to show where the warning was created)
(node:98312) Warning: The 'NO_COLOR' env is ignored due to the 'FORCE_COLOR' env being set.
(Use `node --trace-warnings ...` to show where the warning was created)
(node:98231) Warning: The 'NO_COLOR' env is ignored due to the 'FORCE_COLOR' env being set.
(Use `node --trace-warnings ...` to show where the warning was created)
(node:98322) Warning: The 'NO_COLOR' env is ignored due to the 'FORCE_COLOR' env being set.
(Use `node --trace-warnings ...` to show where the warning was created)
(node:98353) Warning: The 'NO_COLOR' env is ignored due to the 'FORCE_COLOR' env being set.
(Use `node --trace-warnings ...` to show where the warning was created)
(node:98309) Warning: The 'NO_COLOR' env is ignored due to the 'FORCE_COLOR' env being set.
(Use `node --trace-warnings ...` to show where the warning was created)
 ✓ tests/kv-prefix.test.ts (3 tests) 4ms
 ✓ tests/do-name.test.ts (1 test) 4ms
 ✓ tests/resolveTenant.test.ts (4 tests) 30ms
 ✓ tests/rate-limiter.test.ts (2 tests) 5ms
 ✓ tests/session-retention.test.ts (2 tests) 6ms
 ✓ tests/vectorize-tenant-scope.test.ts (2 tests) 5ms
 ✓ tests/search-schema-validation.test.ts (11 tests) 10ms
 ✓ tests/search-caching.test.ts (10 tests) 22ms
 ✓ tests/rag-assembly.test.ts (2 tests) 5ms
 ✓ tests/rag-embeddings.test.ts (3 tests) 5ms
 ✓ tests/rag-vectorize-upsert.test.ts (3 tests) 6ms
 ✓ tests/rag-chunking.test.ts (3 tests) 7ms
 ✓ tests/rag-fixture-retrieval.test.ts (4 tests) 8ms
 ✓ tests/rag-retrieval.test.ts (5 tests) 11ms
 ✓ tests/request-size.test.ts (2 tests) 40ms
 ✓ tests/rate-limit.test.ts (1 test) 43ms
 ✓ tests/session-isolation.test.ts (2 tests) 46ms
 ✓ tests/health.test.ts (4 tests) 43ms
 ✓ tests/token-budget.test.ts (2 tests) 42ms
 ✓ tests/ingest-search.test.ts (2 tests) 46ms
 ✓ tests/streaming.test.ts (2 tests) 48ms
 ✓ tests/chat.test.ts (9 tests) 50ms
 ✓ tests/ai-gateway.test.ts (6 tests) 56ms

 Test Files  23 passed (23)
      Tests  85 passed (85)
   Start at  07:31:07
   Duration  1.06s (transform 5.90s, setup 0ms, import 7.90s, tests 541ms, environment 5ms)

